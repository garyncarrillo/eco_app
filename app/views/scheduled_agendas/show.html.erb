<p id="notice"><%= notice %></p>
<input style="display: none;" id="scheduled-agenda-id" type="text" value="<%= @scheduled_agenda.id%>" />
<p>
  <strong>Address:</strong>
  <%= @scheduled_agenda.address %>
</p>

<p>
  <strong>Contact name:</strong>
  <%= @scheduled_agenda.contact_name %>
</p>

<p>
  <strong>Contact email:</strong>
  <%= @scheduled_agenda.contact_email %>
</p>

<p>
  <strong>Contact phone number:</strong>
  <%= @scheduled_agenda.contact_phone_number %>
</p>

<p>
  <strong>Scheduled date:</strong>
  <%= @scheduled_agenda.scheduled_date %>
</p>


<button class="show-btn">Add product</button>
<br>
<br>
<br>
<table>
  <thead>
    <tr>
      <th>id</th>
      <th>Description</th>
      <th>High</th>
      <th>Width</th>
      <th>Weight</th>
      <th>Observation</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody id="scheduled_date-product-list">
    <% @scheduled_agenda.products.each do |product| %>
      <tr>
        <td><%= product.id %></td>
        <td><%= product.description %></td>
        <td><%= product.high %></td>
        <td><%= product.width %></td>
        <td><%= product.weight %></td>
        <td><%= product.observation %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>
<br>
<br>
<%= link_to 'Edit', edit_scheduled_agenda_path(@scheduled_agenda) %> |
<%= link_to 'Back', scheduled_agendas_path %>



<div id="dialog" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <span id="dialog-close" class="close">&times;</span>
    <p>Some text in the Modal..</p>
      <table>
        <thead>
          <tr>
            <th>Id</th>
            <th>Description</th>
            <th>Add</th>
            <th colspan="3"></th>
          </tr>
        </thead>
        <tbody id="product-list">
        </tbody>
      </table>
  </div>
</div>


<script>
  let products = []

  function loadProduct() {
    $.ajax({
      url: '/products',
      type: 'GET',
      dataType: 'json',
      // data: {
      //   format: 'json'
      // },
      success: function(data) {
        products = data.products;
        $.each(data.products, function(i, product) {
          $("#product-list").append('<tr><td>'+product.id+'</td><td>'+product.description+'</td><td><button onclick="button(this)" name="'+product.id+'">add</button></td></tr>');
        });
      },
      error: function(data) {
        console.log("error ", data);
      },
    });
  }

  function addProductOnScheduledAgenda(params) {
    let id =  $('#scheduled-agenda-id').val();
    $.ajax({
      url: '/scheduled_agendas/'+id+'/add_product',
      type: 'POST',
      dataType: 'json',
      data: {
        collect: {
          product_id: params
        }
      },
      success: function(data) {
        console.log("todo ok ", data);
        $("#scheduled_date-product-list").append('<tr><td>'+data.product.id+'</td><td>'+data.product.description+'</td><td>'+data.product.high+'</td><td>'+data.product.width+'</td><td>'+data.product.weight+'</td><td>'+data.product.observation+'</td></tr>');
      },
      error: function(data) {
        console.log("error ", data);
      },
    });
  }

  $(document).ready(function(){
    loadProduct();
  });

  function button(event) {
    let element = products.find((product, index) => product.id == event.name);
    var formData = new FormData();
    addProductOnScheduledAgenda(element.id);
  }

  $('.show-btn').on('click', function() {
    $('#dialog').show();
  });

  $('#dialog-close').on('click', function() {
    $('#dialog').hide();
  });
</script>
